<!DOCTYPE html>
<html>
    <head>
        <title>Vibe Chat</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/static/css/styles.css">
    </head>
    <body>
        <div class="chat-container">
            <div class="chat-header">
                <div class="user-info">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h2>Your ID: <span id="ws-id"></span></h2>
                        <div class="status">
                            <span class="status-dot"></span>
                            Online
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="messages-container">
                <div id="messages" class="messages">
                    <!-- Messages will be inserted here -->
                </div>
            </div>

            <div class="chat-input">
                <form action="" onsubmit="sendMessage(event)">
                    <div class="input-wrapper">
                        <input type="text" id="messageText" placeholder="Type your message..." autocomplete="off"/>
                        <button type="submit">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <script>// Initialize WebSocket connection
            const client_id = Date.now();
            document.querySelector("#ws-id").textContent = client_id;
            const ws = new WebSocket(`ws://localhost:8000/ws/${client_id}`);
            
            // Message handling
            ws.onmessage = function(event) {
                const messages = document.getElementById('messages');
                const message = createMessageElement(event.data, 'received');
                messages.appendChild(message);
                scrollToBottom();
            };
            
            // Create message element with proper styling
            function createMessageElement(content, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                
                // Create timestamp
                const timestamp = new Date().toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // Add message content
                messageDiv.innerHTML = `
                    <div class="message-content">${content}</div>
                    <div class="message-timestamp">${timestamp}</div>
                `;
                
                return messageDiv;
            }
            
            // Send message function
            function sendMessage(event) {
                event.preventDefault();
                const input = document.getElementById("messageText");
                const content = input.value.trim();
                
                if (content) {
                    // Send message through WebSocket
                    ws.send(content);
                    
                    // Create and display sent message
                    const messages = document.getElementById('messages');
                    const message = createMessageElement(content, 'sent');
                    messages.appendChild(message);
                    
                    // Clear input and scroll to bottom
                    input.value = '';
                    scrollToBottom();
                }
            }
            
            // Scroll to bottom of messages
            function scrollToBottom() {
                const messagesContainer = document.querySelector('.messages-container');
                setTimeout(() => {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 100); // Small delay to ensure content is rendered
            }
            
            // Scroll to bottom on page load
            window.addEventListener('load', scrollToBottom);
            
            // Scroll to bottom when window is resized
            window.addEventListener('resize', scrollToBottom);
            
            // Add typing animation
            const messageInput = document.getElementById('messageText');
            let typingTimeout;
            
            messageInput.addEventListener('input', () => {
                clearTimeout(typingTimeout);
                // Here you could add code to show "User is typing..." status
                
                typingTimeout = setTimeout(() => {
                    // Here you could add code to clear "User is typing..." status
                }, 1000);
            });
            
            // Handle connection status
            ws.onopen = () => {
                console.log('Connected to chat server');
                const statusDot = document.querySelector('.status-dot');
                statusDot.style.background = '#4ade80';
            };
            
            ws.onclose = () => {
                console.log('Disconnected from chat server');
                const statusDot = document.querySelector('.status-dot');
                statusDot.style.background = '#ef4444';
            };
            
            // Handle emoji shortcuts
            messageInput.addEventListener('keyup', (e) => {
                const shortcuts = {
                    ':)': '😊',
                    ':(': '😢',
                    ':D': '😃',
                    '<3': '❤️',
                    ':p': '😛',
                    ';)': '😉'
                };
                
                for (let shortcut in shortcuts) {
                    if (messageInput.value.includes(shortcut)) {
                        messageInput.value = messageInput.value.replace(shortcut, shortcuts[shortcut]);
                    }
                }
            });
            </script>
    </body>
</html>
